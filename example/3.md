
## Example: Adding OAuth2 Authentication — Full Yellow Path with Tool Execution Separation

**User Request:** `"Add user authentication with OAuth2"`

---

### Step 1 — Codebase Analysis (Analyzer Agent)

**Agent Prediction:**

* Predicts impacted areas: login endpoints, session management, token handling.
* Suggests **Code Analysis Tool** to scan repository for relevant files, classes, and functions.

**Tool Execution (Engine Driven):**

* **Code Analysis Tool** scans the repository based on agent prediction.
* Outputs a structured map of files, classes, and functions to modify.
* Analysis context is stored for feedback loops.

---

### Step 2 — Documentation Gathering (Documenter Agent)

**Agent Prediction:**

* Predicts necessary documentation and external references.
* Suggests **Web Search / Documentation Retrieval Tool** to fetch OAuth2 specifications and client library references.
* Suggests **File Creation Tool** to store curated documentation.

**Tool Execution (Engine Driven):**

* **Web Search / Documentation Retrieval Tool** retrieves specs, integration examples, and client references.
* **File Creation Tool** stores curated docs in a project folder.
* Output: curated guides and references. **Note:** some references may be incomplete.

---

### Step 3 — Integration Strategy (Strategist Agent)

**Agent Prediction:**

* Predicts OAuth2 integration plan: Authorization Code flow with JWT, DB schema changes, endpoint modifications, implementation instructions.
* Suggests using **New File Tool** to create a plan file and **Update File Tool** to update documentation.

**Tool Execution (Engine Driven):**

* **New File Tool** generates the structured integration plan file.
* **Update File Tool** updates project documentation with instructions.
* Plan is passed to Implementer.

---

### Step 4 — Database Schema Design (Schema Designer Agent)

**Agent Prediction:**

* Predicts necessary DB schema changes (token storage, updated user table).
* Suggests **DB Migration Tool** and **Migration Logging Tool**.

**Tool Execution (Engine Driven):**

* **DB Migration Tool** applies schema changes.
* **Migration Logging Tool** records the applied migrations.
* Output: updated DB schema with logs.

---

### Step 5 — Code Implementation (Implementer Agent)

**Agent Prediction:**

* Predicts code and configuration updates for OAuth2.
* Suggests tools: **Edit File Tool**, **New File Tool**, **Execution / Run Tool** for syntax checks.
* Notes missing automated tests and incomplete documentation assumptions.

**Tool Execution (Engine Driven):**

* **Edit File Tool** modifies code files.
* **New File Tool** creates new modules/configs.
* **Execution / Run Tool** runs snippets for syntax verification.
* Output: functional code but gaps remain (tests missing, docs incomplete).

---

### Step 6 — First Validation & Gap Detection (Checker Agent)

**Agent Prediction:**

* Predicts validation steps: run unit/integration tests, check security.
* Suggests **Test Runner Tool** and **Security Scanner Tool**.

**Tool Execution (Engine Driven):**

* **Test Runner Tool** executes available tests.
* **Security Scanner Tool** checks endpoints, tokens, config compliance.
* Output: detected gaps (missing tests, doc inconsistencies) returned to Strategist.

---

### Step 7 — First Plan Revision (Strategist Agent)

**Agent Prediction:**

* Predicts updates: add missing tests, clarify implementation instructions.
* Suggests **Edit File Tool** and **New File Tool** to update plan and create test templates.

**Tool Execution (Engine Driven):**

* **Edit File Tool** updates the plan file.
* **New File Tool** adds templates for missing tests.
* Output: updated plan passed to Implementer.

---

### Step 8 — Second Implementation Iteration (Implementer Agent)

**Agent Prediction:**

* Predicts code and test updates per revised plan.
* Suggests tools: **Edit File Tool**, **New File Tool**, **Execution / Run Tool**.

**Tool Execution (Engine Driven):**

* **Edit File Tool** updates existing code.
* **New File Tool** adds missing test files.
* **Execution / Run Tool** runs code and tests.
* Outcome: some doc issues remain, causing minor test failures.

---

### Step 9 — Iterative Feedback & Documentation Updates (Strategist Agent)

**Agent Prediction:**

* Detects persistent gaps in documentation.
* Suggests **Web Search / Documentation Update Tool** and **Edit File Tool** to enrich plan instructions.

**Tool Execution (Engine Driven):**

* **Web Search / Documentation Update Tool** fetches additional references.
* **Edit File Tool** updates plan and instructions.
* After several iterations, a **full re-analysis** is required.

---

### Step 10 — Full Repository Re-Analysis (Analyzer & Documenter Agents)

**Agent Prediction:**

* Predicts rescan of repo for missed dependencies.
* Predicts fetching corrected documentation.
* Suggests tools: **Code Analysis Tool**, **Web Search / Doc Retrieval Tool**, **New File / Edit File Tools**.

**Tool Execution (Engine Driven):**

* **Code Analysis Tool** rescans repository.
* **Web Search / Doc Retrieval Tool** fetches updated documentation.
* **New File / Edit File Tools** store enriched docs and revised analysis.
* Output: corrected analysis and documentation for new plan.

---

### Step 11 — Final Implementation (Implementer Agent)

**Agent Prediction:**

* Predicts complete code, config, and tests.
* Suggests **Edit File Tool**, **New File Tool**, **Execution / Run Tool**.

**Tool Execution (Engine Driven):**

* **Edit File Tool** updates code.
* **New File Tool** adds missing modules and tests.
* **Execution / Run Tool** executes code and tests.
* Output: fully functional, validated OAuth2 module.

---

### Step 12 — Final Verification (Checker & Verifier Agents)

**Agent Prediction:**

* Predicts final validation steps: full test run, security scan, audit reporting.
* Suggests **Test Runner Tool**, **Security Scanner Tool**, **Audit / Reporting Tool**.

**Tool Execution (Engine Driven):**

* **Test Runner Tool** executes all tests.
* **Security Scanner Tool** checks security and config compliance.
* **Audit / Reporting Tool** generates final audit report.
* Output: deployable, fully compliant OAuth2 authentication module.

---

### ✅ Key Takeaways

* **Agents only predict actions**, tools execute all operations.
* **Iterative loops handle gaps** (tests, documentation, missed dependencies).
* **Context reuse** ensures agents improve predictions in subsequent iterations.
* Clear **separation of prediction vs execution** aligns with system-driven workflows.

